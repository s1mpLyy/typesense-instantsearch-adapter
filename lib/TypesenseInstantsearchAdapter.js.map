{"version":3,"file":"TypesenseInstantsearchAdapter.js","names":["_interopRequireDefault","require","Object","defineProperty","exports","value","_regenerator","_defineProperty2","_toConsumableArray2","_asyncToGenerator2","_classCallCheck2","_createClass2","_Configuration","_typesense","_SearchRequestAdapter","_SearchResponseAdapter","_FacetSearchResponseAdapter","ownKeys","e","r","t","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","getOwnPropertyDescriptors","defineProperties","TypesenseInstantsearchAdapter","options","_this","updateConfiguration","queryEnhancementCache","Map","searchClient","clearCache","search","instantsearchRequests","searchTypesenseAndAdapt","searchForFacetValues","searchTypesenseForFacetValuesAndAdapt","key","_enhanceQuery2","mark","_callee","query","_this$configuration$q","controller","timeoutId","response","data","wrap","_callee$","_context","prev","next","abrupt","configuration","queryEnhancement","enabled","has","get","AbortController","setTimeout","abort","timeout","fetch","url","method","headers","body","JSON","stringify","text","signal","sent","clearTimeout","ok","Error","concat","status","json","processed","set","t0","name","console","warn","message","stop","_enhanceQuery","_x","_enhanceSearchRequests2","_callee3","_this2","allQueries","uniqueQueries","enhancementPromises","enhancements","queryMap","_callee3$","_context3","map","req","params","Set","_ref","_callee2","enhancedQuery","_callee2$","_context2","original","enhanced","_x3","Promise","all","_enhanceSearchRequests","_x2","_searchTypesenseAndAdapt","_callee4","_this3","typesenseResponse","enhancedRequests","adaptedResponses","_callee4$","_context4","_adaptAndPerformTypesenseRequest","results","typesenseResult","index","_validateTypesenseResult","responseAdapter","SearchResponseAdapter","adaptedResponse","adapt","error","_x4","_searchTypesenseForFacetValuesAndAdapt","_callee5","_this4","_callee5$","_context5","FacetSearchResponseAdapter","_x5","_adaptAndPerformTypesenseRequest2","_callee6","requestAdapter","_callee6$","_context6","SearchRequestAdapter","typesenseClient","request","_x6","TypesenseSearchClient","server","clear","Configuration","validate","code","hits","grouped_hits"],"sources":["../src/TypesenseInstantsearchAdapter.js"],"sourcesContent":["\"use strict\";\n\nimport { Configuration } from \"./Configuration\";\nimport { SearchClient as TypesenseSearchClient } from \"typesense\";\nimport { SearchRequestAdapter } from \"./SearchRequestAdapter\";\nimport { SearchResponseAdapter } from \"./SearchResponseAdapter\";\nimport { FacetSearchResponseAdapter } from \"./FacetSearchResponseAdapter\";\n\nexport default class TypesenseInstantsearchAdapter {\n  constructor(options) {\n    this.updateConfiguration(options);\n    this.queryEnhancementCache = new Map();\n    this.searchClient = {\n      clearCache: () => this.clearCache(),\n      search: (instantsearchRequests) => this.searchTypesenseAndAdapt(instantsearchRequests),\n      searchForFacetValues: (instantsearchRequests) =>\n        this.searchTypesenseForFacetValuesAndAdapt(instantsearchRequests),\n    };\n  }\n\n  /**\n   * Enhances a search query by calling an external API\n   */\n  async _enhanceQuery(query) {\n    if (!query || query === \"*\") {\n      return query;\n    }\n\n    // Check if query enhancement is enabled\n    if (!this.configuration.queryEnhancement?.enabled) {\n      return query;\n    }\n\n    // Check cache first\n    if (this.queryEnhancementCache.has(query)) {\n      return this.queryEnhancementCache.get(query);\n    }\n\n    try {\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), this.configuration.queryEnhancement.timeout || 5000);\n\n      const response = await fetch(this.configuration.queryEnhancement.url, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          text: query,\n        }),\n        signal: controller.signal,\n      });\n\n      clearTimeout(timeoutId);\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      const data = await response.json();\n      if (data && data.processed) {\n        // Cache the enhanced query\n        this.queryEnhancementCache.set(query, data.processed);\n        return data.processed;\n      }\n\n      // Cache the original query if no enhancement\n      this.queryEnhancementCache.set(query, query);\n      return query;\n    } catch (error) {\n      if (error.name === \"AbortError\") {\n        console.warn(\n          `[Typesense-Instantsearch-Adapter] Query enhancement timed out after ${this.configuration.queryEnhancement.timeout || 5000}ms`,\n        );\n      } else {\n        console.warn(\"[Typesense-Instantsearch-Adapter] Query enhancement failed:\", error.message);\n      }\n      // Cache the original query on error\n      this.queryEnhancementCache.set(query, query);\n      return query;\n    }\n  }\n\n  async _enhanceSearchRequests(instantsearchRequests) {\n    // Get all unique queries from all requests\n    const allQueries = instantsearchRequests\n      .map((req) => req.params.query)\n      .filter((query) => query && query !== \"\" && query !== \"*\");\n\n    if (allQueries.length === 0) {\n      return instantsearchRequests; // No enhancement needed\n    }\n\n    const uniqueQueries = [...new Set(allQueries)];\n\n    // Enhance all unique queries in parallel\n    const enhancementPromises = uniqueQueries.map(async (query) => {\n      const enhancedQuery = await this._enhanceQuery(query);\n      return { original: query, enhanced: enhancedQuery };\n    });\n\n    const enhancements = await Promise.all(enhancementPromises);\n    const queryMap = new Map(enhancements.map((e) => [e.original, e.enhanced]));\n\n    // Update all requests with enhanced queries\n    return instantsearchRequests.map((req) => {\n      if (req.params.query && req.params.query !== \"\" && req.params.query !== \"*\") {\n        const enhancedQuery = queryMap.get(req.params.query);\n        if (enhancedQuery && enhancedQuery !== req.params.query) {\n          return {\n            ...req,\n            params: {\n              ...req.params,\n              query: enhancedQuery,\n            },\n          };\n        }\n      }\n      return req;\n    });\n  }\n\n  async searchTypesenseAndAdapt(instantsearchRequests) {\n    let typesenseResponse;\n    try {\n      // Enhance queries before processing\n      const enhancedRequests = await this._enhanceSearchRequests(instantsearchRequests);\n\n      typesenseResponse = await this._adaptAndPerformTypesenseRequest(enhancedRequests);\n\n      const adaptedResponses = typesenseResponse.results.map((typesenseResult, index) => {\n        this._validateTypesenseResult(typesenseResult);\n        const responseAdapter = new SearchResponseAdapter(\n          typesenseResult,\n          instantsearchRequests[index], // Use original requests for response mapping\n          this.configuration,\n          typesenseResponse.results,\n          typesenseResponse,\n        );\n        let adaptedResponse = responseAdapter.adapt();\n\n        return adaptedResponse;\n      });\n\n      return {\n        results: adaptedResponses,\n      };\n    } catch (error) {\n      console.error(error);\n      throw error;\n    }\n  }\n\n  async searchTypesenseForFacetValuesAndAdapt(instantsearchRequests) {\n    let typesenseResponse;\n    try {\n      typesenseResponse = await this._adaptAndPerformTypesenseRequest(instantsearchRequests);\n\n      const adaptedResponses = typesenseResponse.results.map((typesenseResult, index) => {\n        this._validateTypesenseResult(typesenseResult);\n        const responseAdapter = new FacetSearchResponseAdapter(\n          typesenseResult,\n          instantsearchRequests[index],\n          this.configuration,\n        );\n        return responseAdapter.adapt();\n      });\n\n      return adaptedResponses;\n    } catch (error) {\n      console.error(error);\n      throw error;\n    }\n  }\n\n  async _adaptAndPerformTypesenseRequest(instantsearchRequests) {\n    const requestAdapter = new SearchRequestAdapter(instantsearchRequests, this.typesenseClient, this.configuration);\n    const typesenseResponse = await requestAdapter.request();\n    return typesenseResponse;\n  }\n\n  clearCache() {\n    this.typesenseClient = new TypesenseSearchClient(this.configuration.server);\n    this.queryEnhancementCache.clear();\n    return this.searchClient;\n  }\n\n  updateConfiguration(options) {\n    this.configuration = new Configuration(options);\n    this.configuration.validate();\n    this.typesenseClient = new TypesenseSearchClient(this.configuration.server);\n    return true;\n  }\n\n  _validateTypesenseResult(typesenseResult) {\n    if (typesenseResult.error) {\n      throw new Error(`${typesenseResult.code} - ${typesenseResult.error}`);\n    }\n    if (!typesenseResult.hits && !typesenseResult.grouped_hits) {\n      throw new Error(`Did not find any hits. ${typesenseResult.code} - ${typesenseResult.error}`);\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}